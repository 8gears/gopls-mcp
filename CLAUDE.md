# CLAUDE.md - Instructions for Claude

## What is gopls-mcp?

[gopls-mcp](https://github.com/xieyuschen/gopls-mcp) is an MCP (Model Context Protocol) server that provides semantic code intelligence for Go projects. It uses gopls (the Go language server) to give Claude IDE-like understanding of your codebase, [gopls-mcp documentation site](https://gopls-mcp.org).

## ‚ö° Critical Protocol: Semantic vs. Text Search

**Core Philosophy: Always use semantic analysis tools instead of text search (grep/ripgrep) for Go code.**

| User Intent | ‚úÖ Tool to Use | ‚ùå Forbidden Command |
|-------------|----------------|----------------------|
| **Find a symbol by name** | `go_search("Name")` (Fuzzy matches!) | `grep "Name"`, `grep "func Name"` |
| **Find usages/references** | `go_symbol_references` | `grep -r "Name" .` |
| **Find definition/signature** | `go_definition` | `grep`, `cat file.go` (just to find loc) |
| **List package symbols** | `go_list_package_symbols` | `ls`, `find`, reading full files |
| **Explore modules** | `go_list_modules`, `go_list_module_packages` | `find . -name "*.go"` |
| **Check compilation** | `go_build_check` | `go build` |
| **Understand dependencies** | `go_get_dependency_graph` | `grep "import"` |
| **Trace call stack** | `go_get_call_hierarchy` | `grep` for callers |
| **Preview rename** | `go_dryrun_rename_symbol` | Manual search & replace |

**Rules:**
1. **Never use grep/ripgrep/find for symbol discovery.**
2. **Never read full files just to find signatures or definitions.**
3. **Never use `go build` for checking errors (use `go_build_check`).**
4. **Ambiguity Handling:** If the user asks for a definition (e.g., "How does X work?") but you do not know which file X is in, you MUST use `go_search` first to locate it, and THEN use `go_definition` or `go_read_file` on the specific result. Do not guess file paths.

## üõ† Tool Reference

<!-- AUTO-GENERATED: DO NOT EDIT -->
<!-- Generated by: go generate ./gopls/mcpbridge/core -->
<!-- Source: gopls/mcpbridge/core/doc.go -->
<!-- Marker: AUTO-GEN-START -->
### Discovery & Navigation

- **go_get_started**: Get a beginner-friendly guide to start exploring the Go project.

- **go_analyze_workspace**: Analyze the entire workspace to discover packages, entry points, and dependencies.

- **go_list_modules**: List current module and direct dependencies only.

- **go_list_module_packages**: List all packages in a given module.

- **go_list_package_symbols**: List all exported symbols (types, functions, constants, variables) in a package.

- **go_search**: Find symbols (functions, types, constants) by name with fuzzy matching.

### Reading & Understanding

- **go_definition**: Jump to the definition of a symbol using semantic location (symbol name, package, scope).

- **go_symbol_references**: Find all usages of a symbol across the codebase using semantic location (symbol name, package, scope).

- **go_implementation**: Find all implementations of an interface or all interfaces implemented by a type using semantic location (symbol name, package, scope).

- **go_read_file**: Read file content through gopls.

- **go_get_package_symbol_detail**: Get detailed symbol information from a package.

- **go_get_call_hierarchy**: Get the call hierarchy for a function using semantic location (symbol name, package, scope).

### Analysis & Refactoring

- **go_get_dependency_graph**: Get the dependency graph for a package.

- **go_dryrun_rename_symbol**: Preview a symbol rename operation across all files (DRY RUN - no changes are applied).

### Verification

- **go_build_check**: Check for compilation and type errors.

### Meta


<!-- Marker: AUTO-GEN-END -->

<!-- To regenerate: cd gopls/mcpbridge/core && go generate -->

## üìö Example Conversations (Few-Shot Learning)

### Example 1: Finding Where a Function is Defined
```
‚ùå BAD INTERACTION:
User: "Where is processRequest defined?"
Assistant: [Uses Grep] ‚Üí grep -rn "func processRequest" .

‚úÖ GOOD INTERACTION:
User: "Where is processRequest defined?"
Assistant: [Uses go_definition]
go_definition(
    symbol_name="processRequest",
    context_file="internal/handlers/request.go"
)
‚Üí Returns: Definition at request.go:42 with signature and docs
```

### Example 2: Finding All Usages
```
‚ùå BAD INTERACTION:
User: "Show me all places that call Start()"
Assistant: [Uses Grep] ‚Üí grep -rn "Start(" .

‚úÖ GOOD INTERACTION:
User: "Show me all places that call Start()"
Assistant: [Uses go_symbol_references]
go_symbol_references(
    symbol_name="Start",
    parent_scope="Server",
    kind="method"
)
‚Üí Returns: 3 usages with file:line:column and code context
```

### Example 3: Understanding a Package
```
‚ùå BAD INTERACTION:
User: "What's in the handlers package?"
Assistant: [Reads all files] ‚Üí Read handlers.go, Read middleware.go, Read ...

‚úÖ GOOD INTERACTION:
User: "What's in the handlers package?"
Assistant: [Uses go_list_package_symbols]
go_list_package_symbols(
    package_path="github.com/yourproject/handlers",
    include_docs=true
)
‚Üí Returns: All exported symbols with signatures and docs
```

### Example 4: Finding Related Functions
```
‚ùå BAD INTERACTION:
User: "Find all functions related to formatting symbols"
Assistant: [Uses Grep] ‚Üí grep -rn "format.*Symbol"

‚úÖ GOOD INTERACTION:
User: "Find all functions related to formatting symbols"
Assistant: [Uses go_search with fuzzy matching]
go_search(query="formatSymbol")
‚Üí Returns: formatPackageSymbols, formatPackageSymbolDetail, FormatSymbolSummary
```
